<html><body><div class="lia-message-template-summary-zone"><div class="lia-message-template-content-zone"><p><ul =""=""><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId-1164566257">Introduction</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--642888206">Prerequisites</a></li><li style="list-style-type:circle; margin-left:30px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId-47673268">Requirements</a></li><li style="list-style-type:circle; margin-left:30px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--1759781195">Components Used</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--1770284299">Background Information</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--1090225929">Configuration</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--410167559">Ports and Reachability</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--543852283">Service status and snmpd.conf</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId-136206087">Logs</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId-816264457">Traps and Queries</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--991190006">MIB Resources</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--311131636">Additional Pointers on Memory and Disk Utilization</a></li><li style="list-style-type:circle; margin-left:30px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--1989503380">Used Memory</a></li><li style="list-style-type:circle; margin-left:30px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--611283069">Free Memory</a></li><li style="list-style-type:circle; margin-left:30px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId-1876229764">Disk Utilization</a></li><li style="list-style-type:circle; margin-left:15px; margin-bottom:1px;"><a href="https://techzone.cisco.com/t5/Identity-Services-Engine-ISE/Configure-and-Understand-SNMP-Traps-to-Monitor-ISE/ta-p/1488630#toc-hId--60307418">Related Information</a></li></ul></p><h2 id="toc-hId--1322946576">&nbsp;</h2><h2 id="toc-hId-1164566257">Introduction</h2><p>&nbsp;</p><p>This document describes how to configure and understand <span>Simple Network Management Protocol (</span>SNMP) traps in order to monitor the Cisco ISE.</p><p>&nbsp;</p><p>&nbsp;</p><h2 id="toc-hId--642888206">Prerequisites</h2><p>&nbsp;</p><h3 id="toc-hId-47673268">Requirements</h3><p><span>Cisco recommends that you have the knowledge of these topics:</span></p><ul>
<li><span>Basic Linux</span></li>
<li><span>SNMP</span></li>
<li><span>Identity Services Engine&nbsp;(ISE)</span></li>
</ul><p>&nbsp;</p><h3 id="toc-hId--1759781195">Components Used</h3><p>The information in this document is based on these software and hardware versions:</p><ul>
<li>Cisco ISE, Release 3.1</li>
<li>RHEL 7 server</li>
</ul><p>&nbsp;</p><p><span>The information in this document was created from the devices in a specific lab environment. All of the devices used in this document started with a cleared (default) configuration. If your network is live, ensure that you understand the potential impact of any command.</span></p><p>&nbsp;</p><h2 id="toc-hId--1770284299">Background Information</h2><h2 id="toc-hId-717228534">&nbsp;</h2><p>SNMP traps are UDP messages sent from an SNMP-enabled device to a remote MIB Server.&nbsp;<span>ISE</span>&nbsp;can be configured to send traps to an SNMP server in order to monitor and troubleshoot. This document aims to familiarize some of the basic checks to isolate issues and understand the limitations of ISE traps.</p><p>&nbsp;</p><h2 id="toc-hId--1090225929">Configuration</h2><p>&nbsp;</p><p>ISE supports SNMP v1, v2, and v3. Check if SNMP is enabled on the ISE CLI and the rest of the configuration.</p><p>&nbsp;</p><p>For example, SNMP v3:</p><pre>sotumu24/admin# conf t
Enter configuration commands, one per line.  End with CNTL/Z.
sotumu24/admin(config)# snmp-server enable
sotumu24/admin(config)# snmp-server trap dskThresholdLimit "75"
sotumu24/admin(config)# snmp-server community SNMP$tring ro
sotumu24/admin(config)# snmp-server user SNMPUSER v3 plain authpasswd privpasswd
<br /><br />sotumu24/admin(config)# snmp-server host 10.127.197.81 version 3 SNMPUSER 0x474b49494c49464e474943 plain authpasswd privpasswd<br /><br /><strong>&gt;&gt; The SNMP server might require the engineID if version 3 is being used and it can be dervied from the output of the command here :</strong><br />
sotumu24/admin# show snmp-server engineID
Local SNMP EngineID: GKIILIFNGIC<br />
<strong>&gt;&gt; This is the same as ISE Serial number, need not be configured. 
</strong>
sotumu24/admin# sh udi

SPID: ISE-VM-K9
VPID: V01
Serial: GKIILIFNGIC
</pre><h2 id="toc-hId-1397286904">&nbsp;</h2><h2 id="toc-hId--410167559">Ports and Reachability</h2><p>&nbsp;</p><p>The remote server must be able to reach the ISE in order to query traps if required. Ensure that ISE allows the SNMP server in IP access (if configured).</p><p>&nbsp;</p><p><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="Captura de pantalla 2023-05-25 a la(s) 14.17.51.png" style="width: 835px;"><img src="/c/dam/en/us/support/docs/security/identity-services-engine/215521-configure-and-understand-snmp-traps-to-m-00.png" alt="Verification of Remote Server Accesses ISE for SNMP Trap Query" aria-label="Verification of Remote Server Accesses ISE for SNMP Trap Query" /></span></p><p>&nbsp;</p><p>Check if port 161 is open on ISE CLI:</p><pre>sotumu24/admin# sh ports | in 161
     udp: 0.0.0.0:25087, 0.0.0.0:161
--
     tcp: 169.254.0.228:49, 10.127.197.81:49, 169.254.0.228:50, 10.127.197.81:50
, 169.254.0.228:51, 10.127.197.81:51, 169.254.0.228:52, 10.127.197.81:52, 127.0.
0.1:8888, 10.127.197.81:8443, :::443, 10.127.197.81:8444, 10.127.197.81:8445, ::
:9085, 10.127.197.81:8446, :::19231, :::9090, 127.0.0.1:2020, :::9060, :::9061,
:::8905, :::8009, :::5514, :::9002, :::1099, :::8910, :::61616, :::80, :::9080<br /><br />
</pre><p>&nbsp;</p><h2 id="toc-hId-1943660550">&nbsp;</h2><h2 id="toc-hId-136206087">Logs</h2><p>&nbsp;</p><p>If the SNMP service daemon is stuck or unable to restart,&nbsp;the errors are seen in the messages log file.</p><pre>2020-04-27T12:28:45.326652+05:30 sotumu24 su: (to oracle) root on none
2020-04-27T12:29:48.391712+05:30 sotumu24 snmpd[81079]: Received TERM or STOP signal...  shutting down...
2020-04-27T12:29:48.590240+05:30 sotumu24 snmpd[47597]: NET-SNMP version 5.7.2
2020-04-27T12:30:29.319929+05:30 sotumu24 rsyslogd: [origin software="rsyslogd" swVersion="7.4.7" x-pid="20126" x-info="http://www.rsyslog.com"] rsyslogd was HUPed</pre><h2 id="toc-hId--1671248376">&nbsp;</h2><h2 id="toc-hId-816264457">Traps and Queries</h2><p><br />Generic SNMP traps generated by default in Cisco ISE:</p><p>&nbsp;</p><p><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="Generic SNMP Traps Generated by Default in Cisco ISE" style="width: 999px;"><img src="/c/dam/en/us/support/docs/security/identity-services-engine/215521-configure-and-understand-snmp-traps-to-m-01.png" alt="Default SNMP Traps Generated by Cisco ISE" aria-label="Default SNMP Traps Generated by Cisco ISE" /></span></p><p>&nbsp;</p><p>ISE does not have any MIB for process status or disk utilization. Cisco ISE uses <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset"><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">OID HOST-RESOURCES-MIB::hrSWRunName</code>&nbsp;</code>&nbsp;&nbsp;</strong>for SNMP traps.&nbsp;<strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">snmp walk</code>&nbsp;</strong>&nbsp;or <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">snmp get</code>&nbsp;</strong>&nbsp;command, in order to query the process status or disk utilization, cannot be used in ISE.</p><p>&nbsp;</p><p>For more information, refer to the section&nbsp;<a class="self_link" href="https://www.cisco.com/c/en/us/td/docs/security/ise/3-1/admin_guide/b_ise_admin_3_1/b_ISE_admin_31_troubleshooting.html#id_17078" target="_blank" rel="noopener nofollow noreferrer"> SNMP Traps to Monitor Cisco ISE </a>in the <a href="https://www.cisco.com/c/en/us/td/docs/security/ise/3-1/admin_guide/b_ise_admin_3_1.html" target="_blank" rel="noopener nofollow noreferrer">Cisco Identity Services Engine Administrator Guide, Release 3.1</a>.</p><p>&nbsp;</p><p>In the lab, SNMP Trap was set to trigger when the disk utilization crosses the threshold limit 75: <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">sotumu24/admin(config)# snmp-server trap dskThresholdLimit "75"</code>&nbsp;</strong>.</p><p>&nbsp;</p><p>The data for this trap is collected from the outputs shown.</p><p>&nbsp;</p><p>Run these commands on an external LINUX box or SNMP Server console:</p><pre>Linux/admin# snmpwalk -v 3 -l authPriv -u SNMPUSER -a sha -x AES -A "authpasswd" -X "privpasswd" 10.127.197.217 dskPercent <strong>&gt;&gt; Gives the percentage of disk utilized. Also works with – hrStorageSize</strong>.

UCD-SNMP-MIB::dskPercent.1 = INTEGER: 11
UCD-SNMP-MIB::dskPercent.6 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.8 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.9 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.29 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.30 = INTEGER: 23
UCD-SNMP-MIB::dskPercent.31 = INTEGER: 2
UCD-SNMP-MIB::dskPercent.32 = INTEGER: 5
UCD-SNMP-MIB::dskPercent.33 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.34 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.35 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.36 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.37 = INTEGER: 5
UCD-SNMP-MIB::dskPercent.39 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.41 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.42 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.43 = INTEGER: 0
UCD-SNMP-MIB::dskPercent.44 = INTEGER: 0

Linux/admin# snmpwalk -v 3 -l authPriv -u SNMPUSER -a sha -x AES -A "authpasswd" -X "privpasswd" 10.127.197.217 dskPath <strong>&gt;&gt; Gives the list of disk path(s). Also works with – hrStorageDescr</strong>.

UCD-SNMP-MIB::dskPath.1 = STRING: /
UCD-SNMP-MIB::dskPath.6 = STRING: /dev/shm
UCD-SNMP-MIB::dskPath.8 = STRING: /run
UCD-SNMP-MIB::dskPath.9 = STRING: /sys/fs/cgroup
UCD-SNMP-MIB::dskPath.29 = STRING: /tmp
UCD-SNMP-MIB::dskPath.30 = STRING: /boot
UCD-SNMP-MIB::dskPath.31 = STRING: /storedconfig
UCD-SNMP-MIB::dskPath.32 = STRING: /opt
UCD-SNMP-MIB::dskPath.33 = STRING: /localdisk
UCD-SNMP-MIB::dskPath.34 = STRING: /run/user/440
UCD-SNMP-MIB::dskPath.35 = STRING: /run/user/301
UCD-SNMP-MIB::dskPath.36 = STRING: /run/user/321
UCD-SNMP-MIB::dskPath.37 = STRING: /opt/docker/runtime/overlay
UCD-SNMP-MIB::dskPath.39 = STRING: /opt/docker/runtime/containers/ae1cef55c92ba90ae6c848bd74c9277c2fb52a48ab781455ec9b1149e4634d2c/shm
UCD-SNMP-MIB::dskPath.41 = STRING: /run/user/0
UCD-SNMP-MIB::dskPath.42 = STRING: /run/user/304
UCD-SNMP-MIB::dskPath.43 = STRING: /run/user/303
UCD-SNMP-MIB::dskPath.44 = STRING: /run/user/322</pre><p>From these outputs, the disk utilization is calculated and when the value reaches 75, an SNMP Trap is sent to the configured SNMP-sever HOST. There is no MIB Resource in order to calculate and display the disk utilization directly.</p><p>&nbsp;</p><p>Further, the MIB process <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">hrSWRunName</code>&nbsp;</strong>&nbsp;is used to collect this information (as per the ISE Admin Guide).</p><p>&nbsp;</p><p>A textual description of this running piece of software, that includes the manufacturer, revision, and the name by which it is commonly known. If this software was installed locally, this must be the same string as that used in the <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">hrSWInstalledName&nbsp;</code></strong>that corresponds. The services taken into consideration are <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">app-server</code>&nbsp;</strong>, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">rsyslog</code>&nbsp;</strong>, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">redis-server</code>&nbsp;</strong>, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">ad-connector</code>&nbsp;</strong>, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">mnt-collector</code></strong>&nbsp;, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">mnt-processor</code></strong>&nbsp;, <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">ca-server est-server</code></strong>&nbsp;, and <strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">elasticsearch</code>&nbsp;</strong>.</p><p>&nbsp;</p><h2 id="toc-hId--991190006">MIB Resources</h2><p>&nbsp;</p><p>ISE application is hosted on RHEL OS(Linux). However, as mentioned in the ISE admin guide, ISE uses Host Resources MIB to gather SNMP Trap information. This document has the list of Host Resources MIB that can be queried:</p><p><a href="http://www.net-snmp.org/docs/mibs/host.html" target="_blank" rel="noopener nofollow noreferrer">SNMP HOST MIB.</a></p><p>&nbsp;</p><p>From the document, it can be inferred that there are no direct queries that can calculate and display the values of CPU, Memory, or Disk utilization. However, the data that is used to calculate the outputs are present in these tables:</p><ul>
<li><strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">hrSWRunPerf</code>&nbsp;</strong>&nbsp;Table</li>
<li><strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">hrDiskStorage</code>&nbsp;</strong>&nbsp;Table</li>
<li>Scalars Table</li>
</ul><h2 id="toc-hId-1496322827">&nbsp;</h2><h2 id="toc-hId--311131636">Additional Pointers on Memory and Disk Utilization</h2><p>&nbsp;</p><h3 id="toc-hId--1989503380">Used Memory</h3><p>In order to calculate the used memory, use:</p><p><strong><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset">mem_used = kb_main_total - kb_main_free - kb_main_cached - kb_main_buffers;</code>&nbsp;</strong></p><p><code class="cCN_CmdName" style="white-space: pre-wrap; font-style: unset; font-weight: unset; font-family: unset"><strong>kb_main_cached = kb_page_cache + kb_slab_reclaimable;</strong></code><strong>&nbsp;&nbsp;</strong></p><p>&nbsp;</p><h3 id="toc-hId-498009453">&nbsp;</h3><h3 id="toc-hId--611283069">Free Memory</h3><p>There is a slight difference between the values collected in the SNMP Server and the ISE CLI root-bash. Memory utilization also has a difference in the values due to slab, which is not accounted for in the SNMP, and it shows the total value.</p><p>&nbsp;</p><p>Free memory is a small amount of memory that is not currently used and causes this difference. This is the wasted part of the memory that the system is unable to utilize.&nbsp;ISE is hosted on a Linux OS and uses all physical memory that is not needed by current programs as a file cache, for efficiency. However, if programs need this physical memory, the kernel reallocates&nbsp;the file cache memory to the former. Hence, the memory used by the file cache is free but unused&nbsp;until it is needed by a program.</p><p>&nbsp;</p><p>Refer to&nbsp;<a href="https://serverfault.com/questions/640459/snmp-memory-values-do-not-match-free" target="_blank" rel="noopener nofollow noreferrer">free memory explanation.</a></p><p>&nbsp;</p><h3 id="toc-hId-1876229764">Disk Utilization</h3><p>&nbsp;</p><p>Similarly, up to 5% of the file system is reserved for the root user in order to reduce file fragmentation. This output is not seen in 'df'.</p><p>Hence, it is expected to see a small difference in the percentage calculated in the root bash and subsequently the CLI output.</p><p>&nbsp;</p><p>SNMP query does not consider this reserved disk space and calculates the output based on the values displayed in the table.</p><p>&nbsp;</p><p>For more information, refer to&nbsp;<a href="https://unix.stackexchange.com/questions/110329/is-there-something-wrong-with-df-output" target="_blank" rel="noopener nofollow noreferrer">difference in df output</a>&nbsp;and&nbsp;<a href="https://askubuntu.com/questions/79981/df-h-shows-incorrect-free-space" target="_blank" rel="noopener nofollow noreferrer">df output reserved disk space.</a></p><p>&nbsp;</p><p>&nbsp;</p><h2 id="toc-hId--60307418">Related Information</h2><p>&nbsp;</p><ul>
<li><a href="https://www.cisco.com/c/en/us/support/index.html?referring_site=bodynav" target="_blank" rel="noopener nofollow noreferrer">Cisco Technical Support &amp; Downloads</a></li>
</ul><p>&nbsp;</p><p>&nbsp;</p></div></div></body></html><link rel="stylesheet" type="text/css" href="https://www.cisco.com/etc/designs/cdc/transformation/support-responsive.css" />
<style type="text/css">
td
{border:1px solid black;}
table 
{border:1px solid black;}
</style>